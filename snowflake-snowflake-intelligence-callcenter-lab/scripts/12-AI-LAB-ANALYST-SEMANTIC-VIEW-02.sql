--------------------------------------------------------------------------
-- Step 1: Set Context
--------------------------------------------------------------------------
-- Sets the current database, schema, and warehouse for analysis.
--------------------------------------------------------------------------

USE DATABASE CALL_CENTER_DB;
USE SCHEMA ANALYTICS;
USE WAREHOUSE USER_STD_XSMALL_WH;

--------------------------------------------------------------------------
-- Step 2: Create Semantic View
--------------------------------------------------------------------------
-- Defines a semantic view over CALL_CENTER_ANALYSIS with:
--   - tables: base table and primary key
--   - facts: numeric measures (e.g., DURATION, OVERALL_SENTIMENT)
--   - dimensions: descriptive attributes with synonyms
--   - metrics: derived KPIs for analysts
--   - extension (CA): sample values, verified queries, filters and time dims
--------------------------------------------------------------------------

CREATE OR REPLACE SEMANTIC VIEW CALL_CENTER_DB.ANALYTICS.CALL_CENTER_ANALYST
	tables (
		CALL_CENTER_DB.ANALYTICS.CALL_CENTER_ANALYSIS primary key (CALL_ID)
	)
	facts (
		PUBLIC CALL_CENTER_ANALYSIS.DURATION as DURATION with synonyms=('length','time','span','period','elapsed_time','call_length','call_duration','conversation_time') comment='The length of time, in seconds, that a customer spent on a call with a call center representative.',
		PUBLIC CALL_CENTER_ANALYSIS.OVERALL_SENTIMENT as OVERALL_SENTIMENT with synonyms=('overall_feeling','general_sentiment','sentiment_score','emotional_tone','overall_mood','sentiment_rating','emotional_response') comment='A measure of the overall sentiment of customer interactions at the call center, ranging from -1 (very negative) to 1 (very positive), with 0 indicating a neutral sentiment.'
	)
	dimensions (
		PUBLIC CALL_CENTER_ANALYSIS.ACTION_ITEMS as ACTION_ITEMS with synonyms=('action_list','tasks','to_do_list','follow_up_items','next_steps','action_required','pending_tasks','outstanding_actions') comment='This column contains the specific tasks or actions that need to be taken by the call center representative to resolve a customer''s issue or complete a service request.',
		PUBLIC CALL_CENTER_ANALYSIS.AUDIO_FILE_URL as AUDIO_FILE_URL with synonyms=('audio_file_location','audio_link','audio_source_url','audio_file_path','media_url','file_location','audio_data_url') comment='URL of the audio file associated with the call, allowing for playback and review of the call recording.',
		PUBLIC CALL_CENTER_ANALYSIS.BRAND_SENTIMENT as BRAND_SENTIMENT with synonyms=('brand_opinion','brand_feeling','brand_attitude','brand_appraisal','brand_emotion','brand_viewpoint','brandDisposition') comment='The sentiment of customer feedback related to a specific brand, categorized as negative, neutral, or positive.',
		PUBLIC CALL_CENTER_ANALYSIS.CALL_CENTER_AGENT as CALL_CENTER_AGENT with synonyms=('call_center_representative','customer_service_agent','call_center_staff','customer_support_specialist','call_center_operator','customer_care_agent','call_center_associate','service_agent') comment='The name of the call center agent who handled the call.',
		PUBLIC CALL_CENTER_ANALYSIS.CALL_DATE as CALL_DATE with synonyms=('call_timestamp','date_of_call','call_initiation_date','call_start_date','call_log_date') comment='Date on which the call was made to or from the call center.',
		PUBLIC CALL_CENTER_ANALYSIS.CALL_ID as CALL_ID with synonyms=('call_reference','conversation_id','interaction_id','session_id','call_identifier','record_id','transcript_id','audio_file_id') comment='Unique identifier for each call handled by the call center.',
		PUBLIC CALL_CENTER_ANALYSIS.CALL_TYPE as CALL_TYPE with synonyms=('call_category','call_classification','interaction_type','conversation_type','communication_method','call_reason','interaction_reason') comment='The type of call made to the call center, indicating whether the customer was calling to cancel a service, make a purchase, or inquire about a product or service.',
		PUBLIC CALL_CENTER_ANALYSIS.COST_SENTIMENT as COST_SENTIMENT with synonyms=('monetary_sentiment','price_sentiment','cost_feeling','expense_sentiment','financial_sentiment','affordability_sentiment','price_emotion','cost_emotional_response') comment='The sentiment of the cost associated with the call, indicating whether the customer expressed a negative, neutral, or positive opinion about the cost.',
		PUBLIC CALL_CENTER_ANALYSIS.ISSUE_RESOLVED as ISSUE_RESOLVED with synonyms=('resolved','issue_fixed','problem_solved','case_closed','issue_closed','resolved_status','resolution_status','issue_resolution','problem_resolution') comment='Indicates whether the customer''s issue was fully resolved, partially resolved, or not resolved at all during the call center interaction.',
		PUBLIC CALL_CENTER_ANALYSIS.PRIMARY_INTENT as PRIMARY_INTENT with synonyms=('main_purpose','primary_goal','main_objective','key_intent','primary_objective','main_aim') comment='The primary reason why a customer contacted the call center.',
		PUBLIC CALL_CENTER_ANALYSIS.PRODUCT_SENTIMENT as PRODUCT_SENTIMENT with synonyms=('product_opinion','product_feeling','product_attitude','product_appraisal','product_assessment') comment='The sentiment of the product as expressed by the customer during the call, categorized as negative, neutral, or positive.',
		PUBLIC CALL_CENTER_ANALYSIS.SUMMARY_ITEMS as SUMMARY_ITEMS with synonyms=('key_points','summary_notes','main_points','summary_bullets','key_takeaways','summary_list','call_highlights') comment='A text summary of the call center interaction, including the customer''s issue, the agent''s resolution, and the outcome.',
		PUBLIC CALL_CENTER_ANALYSIS.TRANSCRIPT as TRANSCRIPT with synonyms=('text','dialogue','conversation','spoken_words','audio_transcription','verbal_exchange','spoken_text','conversation_log') comment='This column contains transcripts of customer service calls, detailing conversations between customers and support representatives at Tech Corp, covering various topics such as billing inquiries, plan upgrades, and dispute resolutions.',
		PUBLIC CALL_CENTER_ANALYSIS.TRANSCRIPT_SUMMARY as TRANSCRIPT_SUMMARY with synonyms=('conversation_summary','call_summary','transcript_overview','summary_of_conversation','conversation_recap','call_transcript_summary') comment='A brief summary of the customer''s issue and the outcome of their interaction with the call center, including the customer''s request, the support agent''s response, and the customer''s level of satisfaction.',
		PUBLIC CALL_CENTER_ANALYSIS.URGENCY_LEVEL as URGENCY_LEVEL with synonyms=('priority_level','importance_level','criticality_level','alert_level','severity_level','emergency_level') comment='Indicates the level of urgency associated with a call, with possible values being low, medium, or high, reflecting the priority and severity of the issue being reported.'
	)
	metrics (
		PUBLIC CALL_CENTER_ANALYSIS.AVG_SENTIMENT_SCORE as AVG(OVERALL_SENTIMENT) with synonyms=('average sentiment; mean sentiment; sentiment average') comment='Average sentiment score across calls',
		PUBLIC CALL_CENTER_ANALYSIS.CALL_COUNT as COUNT(*) with synonyms=('Call Count; Calls') comment='Number of calls',
		PUBLIC CALL_CENTER_ANALYSIS.POSITIVE_PRODUCT_SENTIMENT_RATE as SUM(CASE WHEN PRODUCT_SENTIMENT = 'positive' THEN 1 ELSE 0 END) / COUNT(*) * 100 with synonyms=('positive product sentiment percentage; positive product sentiment') comment='Percentage of calls with positive product sentiment',
		PUBLIC CALL_CENTER_ANALYSIS.RESOLUTION_RATE as SUM(CASE WHEN ISSUE_RESOLVED = 'yes' THEN 1 ELSE 0 END) / COUNT(*) * 100 with synonyms=('resolution percentage; success rate; issue resolution rate') comment='Percentage of calls with issues resolved successfully'
	)
	comment='Call Center Analytics Semantic Model'
	with extension (CA='{"tables":[{"name":"CALL_CENTER_ANALYSIS","dimensions":[{"name":"CALL_ID","sample_values":["CALL_20250728_10034","CALL_20250728_10024","CALL_20250728_10013"]},{"name":"AUDIO_FILE_URL","sample_values":["https://ocb39229.snowflakecomputing.com/api/files/CALL_CENTER_DB/RAW/INT_STAGE_DOC_RAW/CALL_20250728_10046%2emp3","https://ocb39229.snowflakecomputing.com/api/files/CALL_CENTER_DB/RAW/INT_STAGE_DOC_RAW/CALL_20250728_10024%2emp3","https://ocb39229.snowflakecomputing.com/api/files/CALL_CENTER_DB/RAW/INT_STAGE_DOC_RAW/CALL_20250728_10035%2emp3"]},{"name":"CALL_CENTER_AGENT","sample_values":["michael rodriguez","amanda williams","mike thompson"]},{"name":"CALL_TYPE","sample_values":["Cancellation","Sales","Query"],"is_enum":true},{"name":"BRAND_SENTIMENT","sample_values":["negative","neutral","positive"],"is_enum":true},{"name":"COST_SENTIMENT","sample_values":["negative","neutral","positive"],"is_enum":true},{"name":"PRODUCT_SENTIMENT","sample_values":["negative","neutral","positive"]},{"name":"PRIMARY_INTENT","sample_values":["billing","complaint","sales"],"is_enum":true},{"name":"URGENCY_LEVEL","sample_values":["low","medium","high"],"is_enum":true},{"name":"ISSUE_RESOLVED","sample_values":["no","partial","yes"]},{"name":"SUMMARY_ITEMS","sample_values":["* Customer John Smith called about unauthorized $1.73 charge recurring for 3 months\\n* Agent Christopher Lee identified error in premium service package and processed full refund plus $1.36 credit\\n* Issue fully resolved with refund appearing in 2-3 business days and preventive notes added to account","* Customer requested refund for $276 premium service call that failed to fix internet connectivity issues\\n* Support agent processed full refund and scheduled complimentary follow-up visit with senior technician\\n* Issue resolved with customer satisfaction - refund confirmed and Saturday appointment scheduled","* Customer disputed two unauthorized $1.42 charges for ''Premium billing dispute service'' totaling $2.84\\n* Support agent Tony Garcia removed one charge but refused to remove both, claiming system limitations\\n* Customer expressed frustration with service and threatened to switch providers"]},{"name":"ACTION_ITEMS","sample_values":["* Process service cancellation for customer moving to rural Montana\\n* Complete equipment pickup on Tuesday between 1-5 PM\\n* Generate prorated final bill for customer''s last day of service","* No follow-up required - customer''s billing questions were fully answered\\n* Customer informed about option to purchase own equipment if desired","* Process $1.82 refund to appear on next billing statement\\n* Send confirmation email with refund details to customer\\n* Schedule follow-up visit with senior technician for Saturday morning at no charge"]},{"name":"TRANSCRIPT_SUMMARY","sample_values":["Customer, Ashley Brown, contacted Tech Corp Support regarding an unexplained $1.73 charge on her bill. She was advised that there was a previous billing dispute case and was told it would take 7-10 business days for a response. Frustrated with the wait time, she requested to speak to a manager and was offered a callback, but all managers were busy.","The caller, Tony Garcia, discussed billing disputes with Tech Corp support regarding unrecognized charges totaling $1.84 on his account. He was unable to get both charges removed despite not authorizing them, leading to dissatisfaction with the customer service.","A customer called TechCorp support requesting a refund for a faulty router purchased 72 days ago, but the return policy only allows refunds within 30 days. The customer was offered a replacement instead, but refused and expressed dissatisfaction with the customer service."]},{"name":"TRANSCRIPT","sample_values":["Tech Corp Support. James Martinez speaking. How can I help? Hi. I have some questions about my account and billing cycle. I''d be happy to help answer your questions about your account. What specific information do you need? When is my next bill due and can you explain the different charges? Let me pull up your account details. Your next bill is due on August 9 for $1.84. Can you break down what that includes? Certainly. That includes your $1.63 monthly service plan, $1.14 equipment rental, and $1.09 taxes and fees. What''s the equipment rental for? That covers the router and any other equipment we''ve provided. You have the option to purchase your own compatible equipment if you prefer. Good to know. Are there any changes to my plan coming up? No changes are scheduled. Your current plan and pricing are locked in. Is there anything else about your account you''d like me to explain? No. That covers everything. Thank you for the clear explanation.","Tech Corp Support. Emily Davis speaking. How can I help? Hi Emily Davis. I''m interested in upgrading my internet plan. Can you tell me about your higher speed options? I''d be happy to help you explore our upgrade options. Currently you''re on our standard plan. What''s driving your interest in upgrading? My family has been streaming more content and working from home, so we need faster speeds. That makes perfect sense. For multiple users streaming and working remotely, I''d recommend our Ultra plan with 259 megabits per second. What''s the price difference and are there any promotions? The upgrade would be $26 more per month, but we have a promotion offering the first 6 months at just $21 extra. That sounds reasonable. What about installation? Great news, we can activate the higher speeds remotely in most cases. If you need equipment upgrade, we ship it with easy self-install instructions. Perfect. Can we set that up today? Absolutely. I''ll process the upgrade now and you''ll see the faster speeds within 24 hours.","Tech Corp Support, Emily Davis speaking, how can I help? Hi Emily Davis, I''m calling about a billing dispute. I was charged $41 for something I never ordered, and this has been going on for three months now. I sincerely apologize for this billing issue. Nancy Walker, let me immediately look into your account and resolve this for you. Can you provide your account number? Sure. It''s account 307266. Thank you. I can see the charge you''re referring to from our premium service package. I can clearly see this was added in error without your authorization. I''m processing a full refund of $1.41 right now, plus $1.20 credit for the inconvenience you''ve experienced. Wow, that''s more than I expected. Thank you so much. You''ve been a loyal customer for six years, and we value your business. The refund will appear in two to three business days, and I''ve added notes to prevent this from happening again. Is there anything else I can help you with today? No, that''s perfect. Thank you, Emily Davis. You''ve been incredibly helpful. My pleasure. Have a wonderful day and thank you for your patience with this issue."]}],"facts":[{"name":"DURATION","sample_values":["128.387","103.835","104.435"]},{"name":"OVERALL_SENTIMENT","sample_values":["0.87554985","0.48669228","-0.8723772"]}],"metrics":[{"name":"AVG_SENTIMENT_SCORE"},{"name":"CALL_COUNT"},{"name":"POSITIVE_PRODUCT_SENTIMENT_RATE"},{"name":"RESOLUTION_RATE"}],"filters":[{"name":"RESOLVED_CALLS","synonyms":["successful calls","resolved issues"],"description":"Filter for calls where issues were resolved","expr":"ISSUE_RESOLVED = ''yes''"},{"name":"UNRESOLVED_CALLS","synonyms":["open issues","unresolved","pending"],"description":"Calls still open or partially resolved","expr":"ISSUE_RESOLVED <> ''yes''"},{"name":"HIGH_URGENCY","synonyms":["critical","urgent"],"description":"Calls marked as high urgency","expr":"URGENCY_LEVEL = ''high''"},{"name":"POSITIVE_PRODUCT_SENTIMENT","synonyms":["happy product","positive product"],"description":"Calls with positive product feedback","expr":"PRODUCT_SENTIMENT = ''positive''"},{"name":"NEGATIVE_BRAND_SENTIMENT","synonyms":["brand complaints","unhappy brand"],"description":"Calls with negative brand sentiment","expr":"BRAND_SENTIMENT = ''negative''"}],"time_dimensions":[{"name":"CALL_DATE","sample_values":["2025-07-28"]}]}],"verified_queries":[{"name":"What is the average sentiment score by agent?","question":"What is the average sentiment score by agent?","sql":"SELECT\\n  PRIMARY_INTENT,\\n  TO_CHAR(\\n    SUM(\\n      CASE\\n        WHEN ISSUE_RESOLVED = ''yes'' THEN 1\\n        ELSE 0\\n      END\\n    ) / COUNT(*) * 100,\\n    ''FM999990D99\\"%\\"''\\n  ) AS RESOLUTION_RATE\\nFROM\\n  CALL_CENTER_ANALYSIS\\nGROUP BY\\n  PRIMARY_INTENT\\nORDER BY\\n  RESOLUTION_RATE DESC;","use_as_onboarding_question":false,"verified_by":"Douglas Day","verified_at":1755751146},{"name":"Which call types are most frequent and how do they score on average sentiment?","question":"Which call types are most frequent and how do they score on average sentiment?","sql":"SELECT\\n  CALL_TYPE,\\n  COUNT(*) AS CALL_COUNT,\\n  AVG(OVERALL_SENTIMENT) AS AVG_OVERALL_SENTIMENT\\nFROM\\n  CALL_CENTER_ANALYSIS\\nGROUP BY\\n  CALL_TYPE\\nORDER BY\\n  CALL_COUNT DESC;","use_as_onboarding_question":false,"verified_by":"Douglas Day","verified_at":1755751161},{"name":"Which agents have the highest issue‑resolution rate?","question":"Which agents have the highest issue‑resolution rate?","sql":"SELECT\\n  CALL_CENTER_AGENT,\\n  SUM(\\n    CASE\\n      WHEN ISSUE_RESOLVED = ''yes'' THEN 1\\n      ELSE 0\\n    END\\n  ) / COUNT(*) * 100 AS RESOLUTION_RATE\\nFROM\\n  CALL_CENTER_ANALYSIS\\nGROUP BY\\n  CALL_CENTER_AGENT\\nORDER BY\\n  RESOLUTION_RATE DESC;","use_as_onboarding_question":false,"verified_by":"Douglas Day","verified_at":1755751171},{"name":"Which primary intents are most likely to be high urgency?","question":"Which primary intents are most likely to be high urgency?","sql":"SELECT\\n  PRIMARY_INTENT,\\n  SUM(\\n    CASE\\n      WHEN URGENCY_LEVEL = ''high'' THEN 1\\n      ELSE 0\\n    END\\n  ) / COUNT(*) * 100 AS HIGH_URGENCY_RATE\\nFROM\\n  CALL_CENTER_ANALYSIS\\nGROUP BY\\n  PRIMARY_INTENT\\nORDER BY\\n  HIGH_URGENCY_RATE DESC;","use_as_onboarding_question":false,"verified_by":"Douglas Day","verified_at":1755751181},{"name":"What is the resolution rate by call intent?","question":"What is the resolution rate by call intent?","sql":"SELECT\\n  PRIMARY_INTENT,\\n  SUM(\\n    CASE\\n      WHEN ISSUE_RESOLVED = ''yes'' THEN 1\\n      ELSE 0\\n    END\\n  ) / COUNT(*) * 100 AS RESOLUTION_RATE\\nFROM\\n  CALL_CENTER_ANALYSIS\\nGROUP BY\\n  PRIMARY_INTENT\\nORDER BY\\n  RESOLUTION_RATE DESC;","use_as_onboarding_question":false,"verified_by":"Douglas Day","verified_at":1755751190}]}');

--------------------------------------------------------------------------
--------------------------------------------------------------------------
